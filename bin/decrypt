#!/usr/bin/env bash

file_path="phrases.txt"
device="/dev/sda3"
# device="/dev/nvme0n1p3"
command="sudo cryptsetup luksOpen ${device} my_encrypted_volume -"

# Check if the file exists
if [ ! -f "$file_path" ]; then
    echo "Error: File not found at $file_path"
    exit 1
fi

# Read each line and pipe it into the command
while IFS= read -r line; do
    echo "Attempting '$line'..."
    echo "$line" | $command
    exit_status=$?

    if [ $exit_status -ne 2 ]; then
        echo "Exiting with status $exit_status"
        break
    fi
done < "$file_path"
